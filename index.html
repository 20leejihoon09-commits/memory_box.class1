<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¶”ì–µì˜ ìƒì - 1ë°˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #020617;
      color: #e5e7eb;
    }
    .app-shell {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }
    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
      }
      .sidebar {
        position: sticky;
        top: 0;
        z-index: 10;
      }
    }

    /* ì‚¬ì´ë“œë°” */
    .sidebar {
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      padding: 20px;
      border-right: 1px solid rgba(148, 163, 184, 0.2);
    }
    .logo {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.03em;
      margin-bottom: 4px;
    }
    .logo-sub {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 20px;
    }
    .nav-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #6b7280;
      margin-top: 16px;
      margin-bottom: 6px;
    }
    .nav-btn {
      width: 100%;
      text-align: left;
      border: none;
      background: transparent;
      color: #e5e7eb;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.15s, transform 0.08s;
    }
    .nav-btn span.icon {
      font-size: 16px;
    }
    .nav-btn.active,
    .nav-btn:hover {
      background: rgba(59, 130, 246, 0.18);
      transform: translateY(-1px);
    }

    .stat-card {
      margin-top: 20px;
      padding: 10px 12px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, #1d283a, #020617);
      border: 1px solid rgba(148, 163, 184, 0.2);
      font-size: 12px;
    }
    .stat-label {
      color: #9ca3af;
      font-size: 11px;
      margin-bottom: 2px;
    }
    .stat-value {
      font-size: 18px;
      font-weight: 700;
    }

    /* ë©”ì¸ ì˜ì—­ */
    .main {
      padding: 18px 18px 40px 18px;
      background: radial-gradient(circle at top left, #111827, #020617);
    }
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 10px;
    }
    .top-title {
      font-size: 20px;
      font-weight: 700;
    }
    .top-sub {
      font-size: 12px;
      color: #9ca3af;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(59, 130, 246, 0.14);
      color: #bfdbfe;
    }

    .pill {
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #e5e7eb;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #3b82f6, #6366f1);
      color: #e5e7eb;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.5);
      transition: transform 0.1s, box-shadow 0.1s, filter 0.1s;
      white-space: nowrap;
    }
    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 12px 24px rgba(37, 99, 235, 0.7);
    }
    .btn.secondary {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: none;
    }
    .btn.danger {
      background: linear-gradient(135deg, #ef4444, #f97373);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.5);
    }

    .panel {
      border-radius: 18px;
      padding: 18px 18px 18px 18px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 20px 60px rgba(15, 23, 42, 0.9);
      margin-bottom: 16px;
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
      gap: 8px;
    }
    .panel-title {
      font-size: 16px;
      font-weight: 600;
    }
    .panel-sub {
      font-size: 11px;
      color: #9ca3af;
    }

    /* ì°¸ì—¬ì í¼ */
    .question-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 10px;
    }
    .question-card {
      border-radius: 14px;
      padding: 10px 12px;
      background: radial-gradient(circle at top left, #020617, #0b1120);
      border: 1px solid rgba(75, 85, 99, 0.6);
      font-size: 13px;
    }
    .question-label {
      font-weight: 600;
      margin-bottom: 6px;
    }
    .rank-label {
      font-size: 11px;
      color: #9ca3af;
      margin: 2px 0;
    }
    .input {
      width: 100%;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 13px;
      outline: none;
    }
    .input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.6);
    }

    /* ê´€ë¦¬ì í™”ë©´ */
    .admin-layout {
      display: grid;
      grid-template-columns: minmax(260px, 320px) minmax(0, 1fr);
      gap: 14px;
    }
    @media (max-width: 900px) {
      .admin-layout {
        grid-template-columns: 1fr;
      }
    }

    .admin-controls {
      border-radius: 14px;
      padding: 12px;
      background: radial-gradient(circle at top left, #020617, #020617);
      border: 1px solid rgba(55, 65, 81, 0.8);
    }

    .field-label {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    select {
      width: 100%;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 13px;
      outline: none;
    }
    select:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.6);
    }

    .result-box {
      border-radius: 14px;
      padding: 10px 12px;
      background: radial-gradient(circle at top, #020617, #020617);
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 420px;
      overflow-y: auto;
    }
    .result-line-top {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .pill-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #9ca3af;
    }
    .highlight {
      color: #fbbf24;
      font-weight: 600;
    }

    /* ê´€ë¦¬ì ë¡œê·¸ì¸ */
    .login-wrapper {
      max-width: 340px;
    }
  </style>
</head>
<body>
<div class="app-shell">

  <!-- ì‚¬ì´ë“œë°” -->
  <aside class="sidebar">
    <div>
      <div class="logo">ì¶”ì–µì˜ ìƒì</div>
      <div class="logo-sub">1ë°˜ Â· ì¹œêµ¬ ê¸°ì–µ ì €ì¥ì†Œ</div>

      <div class="nav-section-title">ëª¨ë“œ ì„ íƒ</div>
      <button class="nav-btn active" id="nav-participant" onclick="switchView('participant')">
        <span class="icon">ğŸ§‘â€ğŸ“</span> ì°¸ì—¬ì ëª¨ë“œ
      </button>
      <button class="nav-btn" id="nav-admin" onclick="switchView('adminLogin')">
        <span class="icon">ğŸ§‘â€ğŸ«</span> ê´€ë¦¬ì ëª¨ë“œ
      </button>

      <div class="nav-section-title">í˜„ì¬ ìƒíƒœ</div>
      <div class="stat-card">
        <div class="stat-label">ì´ ì œì¶œ ì¸ì›</div>
        <div class="stat-value"><span id="totalVotes">0</span> ëª…</div>
        <div class="stat-label" style="margin-top:6px;">ë°ì´í„°ë² ì´ìŠ¤</div>
        <div style="font-size:11px; color:#9ca3af;">
          memorybox1-5038d<br/>
          <span style="color:#60a5fa;">Realtime Database</span> ì—°ê²°
        </div>
      </div>
    </div>
  </aside>

  <!-- ë©”ì¸ -->
  <main class="main">

    <!-- ìƒë‹¨ ë°” -->
    <div class="top-bar">
      <div>
        <div class="top-title">1ë°˜ Â· ì¶”ì–µì˜ ìƒì</div>
        <div class="top-sub">
          ì˜¤ëŠ˜ì˜ ìš°ë¦¬ ë°˜ì„, ë‚˜ì¤‘ì—ëŠ” <span class="highlight">ì¶”ì–µ</span>ìœ¼ë¡œ êº¼ë‚´ë³¼ ìˆ˜ ìˆê²Œ.
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
        <span class="badge">
          <span>ğŸ—³</span> TOP2 íˆ¬í‘œ Â· 10ë¬¸í•­
        </span>
        <span class="pill">
          ì´ë¦„ ì •ê·œí™” ì ìš© (ì§€í›ˆ = ì´ì§€í›ˆ)
        </span>
      </div>
    </div>

    <!-- ì°¸ì—¬ì í™”ë©´ -->
    <section id="view-participant" class="panel">
      <div class="panel-header">
        <div>
          <div class="panel-title">ì°¸ì—¬ì ëª¨ë“œ</div>
          <div class="panel-sub">
            ê° ë¬¸í•­ë§ˆë‹¤ 1ìœ„(2ì ), 2ìœ„(1ì )ì„ ê¸°ì–µë‚˜ëŠ” ì¹œêµ¬ ì´ë¦„ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”.
          </div>
        </div>
        <button class="btn secondary" onclick="resetParticipantForm()">
          ì´ˆê¸°í™”
        </button>
      </div>

      <div class="panel" style="margin:0 0 12px 0; padding:10px 12px; background:rgba(15,23,42,0.9);">
        <div style="font-size:12px; color:#9ca3af;">
          â€¢ ì´ë¦„ì€ <span class="highlight">ë°˜ì—ì„œ í†µì¼ëœ ë°©ì‹</span>ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”. (ì˜ˆ: "í™ê¸¸ë™")<br/>
          â€¢ ê°™ì€ ì¹œêµ¬ë¥¼ 1ìœ„/2ìœ„ ë‘˜ ë‹¤ ì ìœ¼ë©´, <span class="highlight">1ìœ„ë§Œ ì¸ì •</span>ë©ë‹ˆë‹¤.<br/>
          â€¢ ì œì¶œ í›„ì—ëŠ” ë‹¤ì‹œ ìˆ˜ì •í•  ìˆ˜ ì—†ìœ¼ë‹ˆ, í•œ ë²ˆ ë” í™•ì¸í•˜ê³  ì œì¶œí•´ì£¼ì„¸ìš”.
        </div>
      </div>

      <div id="questions" class="question-grid"></div>

      <div style="margin-top:14px; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap;">
        <button class="btn" onclick="submitVotes()">ì œì¶œí•˜ê¸°</button>
      </div>
    </section>

    <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ -->
    <section id="view-adminLogin" class="panel" style="display:none;">
      <div class="panel-header">
        <div>
          <div class="panel-title">ê´€ë¦¬ì ë¡œê·¸ì¸</div>
          <div class="panel-sub">
            ë‹´ì„ì„ ìƒë‹˜ ë° ê´€ë¦¬ì ì „ìš© ì˜ì—­ì…ë‹ˆë‹¤.
          </div>
        </div>
      </div>
      <div class="login-wrapper">
        <label class="field-label">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
        <input
          id="adminPW"
          class="input"
          type="password"
          placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."
        />
        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" onclick="checkAdmin()">ë¡œê·¸ì¸</button>
          <button class="btn secondary" onclick="switchView('participant')">ì°¸ì—¬ì ëª¨ë“œë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
      </div>
    </section>

    <!-- ê´€ë¦¬ì íŒ¨ë„ -->
    <section id="view-adminPanel" class="panel" style="display:none;">
      <div class="panel-header">
        <div>
          <div class="panel-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Â· 1ë°˜</div>
          <div class="panel-sub">
            Realtime Databaseì— ì €ì¥ëœ 1ë°˜ ì „ì²´ ì‘ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ í†µê³„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
          </div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn secondary" onclick="refreshData()">ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
          <button class="btn danger" onclick="resetAll()">ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
      </div>

      <div class="admin-layout">
        <div class="admin-controls">
          <div style="margin-bottom:10px;">
            <div class="field-label">í˜„ì¬ ì´ ì œì¶œ ì¸ì›</div>
            <div style="font-size:22px; font-weight:700;">
              <span id="totalVotesAdmin">0</span> ëª…
            </div>
          </div>

          <div style="margin-bottom:12px;">
            <div class="field-label">ì§ˆë¬¸ ì„ íƒ</div>
            <select id="graphSelect"></select>
          </div>

          <div style="display:flex; flex-wrap:wrap; gap:8px;">
            <button class="btn secondary" onclick="showQuestionResult()">ì„ íƒí•œ ì§ˆë¬¸ ê²°ê³¼</button>
            <button class="btn secondary" onclick="showTotal()">ì „ì²´ í•©ì‚° ìˆœìœ„</button>
          </div>

          <div style="margin-top:12px; font-size:11px; color:#9ca3af;">
            <div class="pill-tag">
              <span>â„¹</span> ì´ë¦„ì€ ë ë‘ ê¸€ì ê¸°ì¤€ ì •ê·œí™”ë¨ (ì˜ˆ: ì´ì§€í›ˆ â†’ ì§€í›ˆ)
            </div>
          </div>
        </div>

        <div class="result-box" id="resultBox">
ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.
        </div>
      </div>
    </section>

  </main>
</div>

<!-- Firebase SDK v8 (ê¸€ë¡œë²Œ) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  // 1ë°˜ ì „ìš© Firebase ì„¤ì •
  const firebaseConfig = {
    apiKey: "AIzaSyA1pxgogV8t4HzZaIWrGUfwMXNTS5m31iI",
    authDomain: "memorybox1-5038d.firebaseapp.com",
    databaseURL: "https://memorybox1-5038d-default-rtdb.firebaseio.com",
    projectId: "memorybox1-5038d",
    storageBucket: "memorybox1-5038d.firebasestorage.app",
    messagingSenderId: "152781142952",
    appId: "1:152781142952:web:4d97750375194a3a813b9d",
    measurementId: "G-Y1DDC4ETSM"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<script>
  // ===== ê³µí†µ ì„¤ì • =====
  const QUESTIONS = [
    "ì²­ì†Œë¥¼ ì—´ì‹¬íˆ í•˜ë˜ ì¹œêµ¬",
    "ë„ì›€ì´ í•„ìš”í•  ë•Œ ê¸°ëŒˆ ìˆ˜ ìˆì—ˆë˜ ì¹œêµ¬",
    "í•™êµ í–‰ì‚¬, ì¼ì • ë“± ì „ë‹¬ ì‚¬í•­ì„ ì˜ ê³µì§€í•´ì£¼ë˜ ì¹œêµ¬",
    "ìˆ˜ì—… ë¶„ìœ„ê¸° ì¡°ì„±ì„ ì˜ ë§ì¶°ì£¼ë˜ ì¹œêµ¬",
    "í˜ë“¤ ë•Œ ì›ƒì„ ìˆ˜ ìˆê²Œ í•´ì£¼ë˜ ì¹œêµ¬",
    "í•™êµ í–‰ì‚¬ì— ì—´ì‹¬íˆ ì°¸ì—¬í•˜ë˜ ì¹œêµ¬",
    "ë¦¬ë”ì‹­, ì¹´ë¦¬ìŠ¤ë§ˆê°€ ë„˜ì¹˜ë˜ ì¹œêµ¬",
    "ë´‰ì‚¬í™œë™ì„ ì—´ì‹¬íˆ í•˜ë˜ ì¹œêµ¬",
    "ì‚¬ì†Œí•œ ì¼ì—ë„ ì•½ì†ì„ ì˜ ì§€í‚¤ë˜ ì¹œêµ¬",
    "ë°”ë¥¸ì–¸ì–´, ë°”ë¥¸ í–‰ë™ ë“± í’ˆì„±ì´ ì•„ë¦„ë‹µë˜ ì¹œêµ¬"
  ];

  const ADMIN_PASSWORD = "YCHS1315";

  const KEY_CLIENT = "memoryBox1_clientId_v1";
  const KEY_SUBMITTED = "memoryBox1_submitted_v1";

  let cachedSubmissions = {}; // Firebaseì—ì„œ ì½ì–´ì˜¨ ì „ì²´ ì‘ë‹µ

  // ===== í´ë¼ì´ì–¸íŠ¸ ID (ê¸°ê¸° ê³ ìœ  ID) =====
  function getClientId() {
    let id = localStorage.getItem(KEY_CLIENT);
    if (!id) {
      id = "client_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
      localStorage.setItem(KEY_CLIENT, id);
    }
    return id;
  }

  // ===== í™”ë©´ ì „í™˜ =====
  function switchView(view) {
    document.getElementById("view-participant").style.display = (view === "participant") ? "block" : "none";
    document.getElementById("view-adminLogin").style.display = (view === "adminLogin") ? "block" : "none";
    document.getElementById("view-adminPanel").style.display = (view === "adminPanel") ? "block" : "none";

    document.getElementById("nav-participant").classList.toggle("active", view === "participant");
    document.getElementById("nav-admin").classList.toggle("active", view !== "participant");
  }

  // ===== ì°¸ì—¬ì í¼ êµ¬ì„± =====
  function buildQuestionForm() {
    const box = document.getElementById("questions");
    box.innerHTML = "";

    QUESTIONS.forEach((q, i) => {
      const div = document.createElement("div");
      div.className = "question-card";
      div.innerHTML = `
        <div class="question-label">${i + 1}. ${q}</div>
        <div class="rank-label">1ìœ„ (2ì )</div>
        <input id="q${i}_1" class="input" placeholder="ì˜ˆ: í™ê¸¸ë™" />
        <div class="rank-label">2ìœ„ (1ì )</div>
        <input id="q${i}_2" class="input" placeholder="ì˜ˆ: í™ê¸¸ë™" />
      `;
      box.appendChild(div);
    });
  }

  function resetParticipantForm() {
    buildQuestionForm();
  }

  // ì´ë¦„ ì •ê·œí™”: ê³µë°± ì œê±° + í˜¸ì¹­ ì œê±° + ë ë‘ ê¸€ì ì‚¬ìš©
  function normalizeName(name) {
    if (!name) return "";
    name = name.trim();
    name = name.replace(/\s+/g, "");
    name = name.replace(/(ì´|ì•¼|ë‹˜|êµ°|ì–‘|ì”¨|ìš”)$/g, "");
    if (name.length >= 2) {
      name = name.slice(-2);
    }
    return name;
  }

  // ===== ì°¸ì—¬ì ì œì¶œ =====
  function submitVotes() {
    if (localStorage.getItem(KEY_SUBMITTED) === "yes") {
      alert("ì´ë¯¸ ì´ ê¸°ê¸°ì—ì„œ ì œì¶œí•œ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.");
      return;
    }

    const clientId = getClientId();
    const submission = {};

    QUESTIONS.forEach((_, qi) => {
      const rawFirst = document.getElementById(`q${qi}_1`).value;
      const rawSecond = document.getElementById(`q${qi}_2`).value;

      let first = normalizeName(rawFirst);
      let second = normalizeName(rawSecond);

      if (!submission[qi]) submission[qi] = {};

      if (first && second && first === second) {
        second = "";
      }

      if (first) {
        if (!submission[qi][first]) submission[qi][first] = 0;
        submission[qi][first] += 2;
      }
      if (second) {
        if (!submission[qi][second]) submission[qi][second] = 0;
        submission[qi][second] += 1;
      }
    });

    db.ref("submissions/" + clientId).set(submission)
      .then(() => {
        localStorage.setItem(KEY_SUBMITTED, "yes");
        alert("ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì°¸ì—¬í•´ì¤˜ì„œ ê³ ë§ˆì›Œìš” :)");
        switchView("participant");
        resetParticipantForm();
        refreshData(); // ì‚¬ì´ë“œë°” ìˆ«ì ì—…ë°ì´íŠ¸
      })
      .catch((err) => {
        console.error(err);
        alert("ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      });
  }

  // ===== ê´€ë¦¬ì ë¡œê·¸ì¸ / ëŒ€ì‹œë³´ë“œ =====
  function checkAdmin() {
    const pw = document.getElementById("adminPW").value;
    if (pw === ADMIN_PASSWORD) {
      document.getElementById("adminPW").value = "";
      switchView("adminPanel");
      buildGraphSelector();
      refreshData();
    } else {
      alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    }
  }

  function buildGraphSelector() {
    const sel = document.getElementById("graphSelect");
    sel.innerHTML = "";
    QUESTIONS.forEach((q, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = `${i + 1}. ${q}`;
      sel.appendChild(opt);
    });
  }

  // Firebaseì—ì„œ ì „ì²´ ì œì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  function refreshData() {
    db.ref("submissions").once("value").then((snapshot) => {
      cachedSubmissions = snapshot.val() || {};
      const count = Object.keys(cachedSubmissions).length;
      document.getElementById("totalVotes").innerText = count;
      document.getElementById("totalVotesAdmin").innerText = count;
    });
  }

  // ì§ˆë¬¸ë³„ í†µê³„ ê³„ì‚°
  function computeQuestionStats(questionIndex) {
    const stats = {};
    Object.values(cachedSubmissions).forEach(sub => {
      const qData = sub[questionIndex];
      if (!qData) return;
      Object.entries(qData).forEach(([name, score]) => {
        const norm = normalizeName(name);
        if (!stats[norm]) stats[norm] = 0;
        stats[norm] += score;
      });
    });
    return stats;
  }

  // ì „ì²´ í•©ì‚° í†µê³„
  function computeTotalStats() {
    const total = {};
    Object.values(cachedSubmissions).forEach(sub => {
      Object.values(sub).forEach(qData => {
        Object.entries(qData).forEach(([name, score]) => {
          const norm = normalizeName(name);
          if (!total[norm]) total[norm] = 0;
          total[norm] += score;
        });
      });
    });
    return total;
  }

  function showQuestionResult() {
    const idx = Number(document.getElementById("graphSelect").value);
    const stats = computeQuestionStats(idx);
    const box = document.getElementById("resultBox");

    if (!Object.keys(stats).length) {
      box.textContent = `ğŸ“Œ ${idx + 1}. ${QUESTIONS[idx]}\n\nì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`;
      return;
    }

    const entries = Object.entries(stats).sort((a, b) => b[1] - a[1]);
    let text = `ğŸ“Œ ${idx + 1}. ${QUESTIONS[idx]}\n\n`;

    entries.forEach(([name, score], i) => {
      text += `${i + 1}ìœ„ Â· ${name} : ${score}ì \n`;
    });

    box.textContent = text;
  }

  function showTotal() {
    const total = computeTotalStats();
    const box = document.getElementById("resultBox");

    if (!Object.keys(total).length) {
      box.textContent = "ğŸ“Œ ì „ì²´ í•©ì‚° ê²°ê³¼\n\nì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
      return;
    }

    const entries = Object.entries(total).sort((a, b) => b[1] - a[1]);
    let text = "ğŸ“Œ ì „ì²´ í•©ì‚° ê²°ê³¼\n\n";

    entries.forEach(([name, score], i) => {
      text += `${i + 1}ìœ„ Â· ${name} : ${score}ì \n`;
    });

    box.textContent = text;
  }

  function resetAll() {
    if (!confirm("ì •ë§ë¡œ 1ë°˜ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”? (ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤)")) return;

    db.ref("submissions").set(null).then(() => {
      localStorage.removeItem(KEY_CLIENT);
      localStorage.removeItem(KEY_SUBMITTED);
      cachedSubmissions = {};
      document.getElementById("totalVotes").innerText = "0";
      document.getElementById("totalVotesAdmin").innerText = "0";
      document.getElementById("resultBox").textContent = "ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.";
      alert("1ë°˜ ë°ì´í„°ê°€ ëª¨ë‘ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });
  }

  // ì´ˆê¸° ë¡œë“œ
  window.addEventListener("DOMContentLoaded", () => {
    buildQuestionForm();
    switchView("participant");
    refreshData();
  });
</script>
</body>
</html>
